<!-- Styles -->
<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons.css">
<style>
  table {
    border-collapse: collapse;
  }

  td {
    padding: 1px 0;
    border-bottom: 0;
  }

  input[type="text"] {
    width: 55px;
    margin: 4px 0;
  }

  .inline-block {
    display: inline-block;
    vertical-align: top;
    padding-bottom: 5px;
  }

  .content-left {
    padding-right: 48px;
  }

  .section-title {
    font-weight: bold;
  }

  .dimension-label {
    padding-right: 5px;
  }
</style>

<!-- Content -->
<form id="page-size-form">
  <div class="block">
    <div class="content-left inline-block">
      <div class="section-title">Dimensions</div>
      <table>
        <tbody>
          <tr>
            <td>
              <label class="dimension-label" for="width-input">Width</label>
            </td>
            <td>
              <input type="text" id="width-input" />
            </td>
          </tr>
          <tr>
            <td>
              <label class="dimension-label" for="height-input">Height</label>
            </td>
            <td>
              <input type="text" id="height-input" />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="content-right inline-block">
      <div class="section-title">
        <label for="units-input">Units</label>
      </div>
      <select id="units-input">
        <option value="in">Inches</option>
        <option value="pt">Points</option>
      </select>
    </div>
  </div>
  <div class="block">
    <button type="submit" class="action">Save</button>
    <button id="dialog-cancel-button" onclick="google.script.host.close()">Cancel</button>
  </div>
</form>

<!-- Scripts -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
  $(function() {
    $('#page-size-form').submit(onSave);

    var input = $('#units-input');

    input.data('prev', input.val());
    input.on(
      'change',
      function() {
        var me = $(this);
        var current = me.val();

        onUnitsChange(me.data('prev'), current);

        me.data('prev', current);
      }
    );

    google.script.run
      .withSuccessHandler(function(dimensions) {
        updateDimensions(dimensions, currentUnits());
      })
      .getDimensions();
  });

  function onUnitsChange(prev, current) {
    var dimensions = parseDimensions(prev);
    updateDimensions(dimensions, current);
  }

  function onSave() {
    google.script.run
      .withSuccessHandler(function() {
        google.script.host.close();
      })
      .setDimensions(parseDimensions(currentUnits()));
  }

  function currentUnits() {
    return $('#units-input').val();
  }

  function parseDimensions(units) {
    var dimensions = {
      width: $('#width-input').val(),
      height: $('#height-input').val()
    };

    for (var axis in dimensions) {
      dimensions[axis] = parseDimension(dimensions[axis], units);
    }

    return dimensions;
  }

  function parseDimension(raw, units) {
    var value = parseFloat(raw);

    switch (units) {
      case 'in':
        return value * 72;
      default:
        return value;
    }
  }

  function updateDimensions(dimensions, units) {
    for (var axis in dimensions) {
      $('#' + axis + '-input').val(convertDimension(dimensions[axis], units));
    }
  }

  function convertDimension(points, units) {
    var value = parseFloat(points);

    switch (units) {
      case 'in':
        return value / 72;
      default:
        return value;
    }
  }
</script>